---
title: "SimulationStudy"
author: "Hamda Binte Ajmal"
date: "9 June 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(DBN4GRN)
```

This documents contains a demonstration to learn Dynamic Bayesian Networks from simulated timeseries data, using BIC score, $Score_{LOPC}$ and $Score_{LASSO}$. The name of our R package is 'DBN4GRN'. For further details of algorithms and methods, please see our paper "Dynamic Bayesian network learning to infer sparse models from time series data", which is currently submitted to the \textit{Bioinformatics} journal for review, or email us at \href{h.ajmal1@nuigalway.ie} or \href{michael.madden@nuigalway.ie}.

For this demo, we simulate 2 random datasets, with number of genes set to 50 and number of timepoints set to 20. You can change this number as needed. 

```{r data}
  sim_num <- 1
  seeds <- 1:sim_num
  datasets <- lapply(seeds, function(x) SimulateData(genes = 50, timepoints = 20, seed = x, prop = 0.05))
  
```

Now, we do exhaustive search with maximum number of parents set to 3. We use BIC score as the scoring objective.

```{r exhaustive}

BNs_BIC <- lapply(datasets, function(dataset) ExhaustiveSearchForBestParents(data = dataset$data, type = "Score_BIC"))
results = CalculatePrecisionAndRecallForMultiple(BNs_BIC, datasets)
print(results)
```

Now, we use $Score_{LOPC}$ as a scoring objective with exhaustive search with maximum number of parents set to 3 . 

```{r exhaustive_LOPC}
LOPCs <- lapply(datasets, function(dataset) ExecuteG1DBNS1(datasets$data))
BNs_Score_LOPC <- mapply(function(dataset, lopc) ExhaustiveSearchForBestParents(data = dataset$data, type = "Score_LOPC", gamma = 0.3, score_mat = lopc$S1LS), datasets, LOPCs)
results = CalculatePrecisionAndRecallForMultiple(BNs_Score_LOPC, datasets)
print(results)

```

Now, we use $Score_{LASSO}$ as a scoring objective with exhaustive search with maximum number of parents set to 3.
```{r exhaustive_LASSO}
LASSOs <- lapply(datasets, function(dataset) ApplyLasso(datasets$data))
BNs_Score_LASSO <- mapply(function(dataset, lasso) ExhaustiveSearchForBestParents(data = dataset$data, type = "Score_LOPC", gamma = 0.3, score_mat = lasso), datasets, LASSOs, SIMPLIFY = FALSE)
results = CalculatePrecisionAndRecallForMultiple(BNs_Score_LASSO, datasets)
print(results)

```

For Greedy hill-climbing search with BIC score, we use the following code:
```{r greedy_bic}
BNs_BIC_greedy <- lapply(datasets, function(dataset) GreedySearchParentsWithPriors(data = dataset$data, score = "Score_BIC", maxP = 3 ))
results = CalculatePrecisionAndRecallForMultiple(BNs_Score_LASSO, datasets)
print(results)

```

Similarly, greedy hill-climbing search with $Score_{LOPC}$:
```{r greedy_LOPC}
BNs_Score_LOPC_greedy <- mapply(function(dataset, lopc) GreedySearchParentsWithPriors(data = dataset$data, score = "Score_LOPC", maxP = 3, gamma = 0.6, score_mat = lopc ), datasets, LOPCs, SIMPLIFY = FALSE)
results = CalculatePrecisionAndRecallForMultiple(BNs_Score_LOPC_greedy, datasets)
print(results)

```
And, greedy hill-climbing search with $Score_{LASSO}$:
```{r greedy_LASSO}
BNs_Score_LASSO_greedy <- mapply(function(dataset, lopc) GreedySearchParentsWithPriors(data = dataset$data, score = "Score_Lasso", maxP = 3, gamma = 0.6, score_mat = lasso ), datasets, LASSOs, SIMPLIFY = FALSE)
results = CalculatePrecisionAndRecallForMultiple(BNs_Score_LASSO_greedy, datasets)
print(results)

```
